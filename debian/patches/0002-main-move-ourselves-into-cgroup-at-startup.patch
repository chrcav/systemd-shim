From c5940b1e69b93b9a5f3a5eb724dc2d7513c5a495 Mon Sep 17 00:00:00 2001
From: Serge Hallyn <serge.hallyn@ubuntu.com>
Date: Mon, 14 Jul 2014 19:28:33 -0400
Subject: [PATCH 2/3] main: move ourselves into / cgroup at startup

Signed-off-by: Serge Hallyn <serge.hallyn@ubuntu.com>
---
 src/cgmanager.c    | 6 ++++++
 src/cgmanager.h    | 2 ++
 src/systemd-shim.c | 1 +
 3 files changed, 9 insertions(+)

diff --git a/src/cgmanager.c b/src/cgmanager.c
index 30410b8..08cafef 100644
--- a/src/cgmanager.c
+++ b/src/cgmanager.c
@@ -158,3 +158,9 @@ cgmanager_remove (const gchar *path)
 
   cgmanager_call ("Remove", g_variant_new ("(ssi)", "all", path, 1), G_VARIANT_TYPE ("(i)"));
 }
+
+void
+cgmanager_moveself (void)
+{
+  cgmanager_call ("MovePidAbs", g_variant_new ("(ssi)", "all", "/", getpid()), G_VARIANT_TYPE_UNIT);
+}
diff --git a/src/cgmanager.h b/src/cgmanager.h
index eef704d..dd6b84c 100644
--- a/src/cgmanager.h
+++ b/src/cgmanager.h
@@ -32,4 +32,6 @@ void cgmanager_create (const gchar *path,
 
 void cgmanager_remove (const gchar *path);
 
+void cgmanager_moveself (void);
+
 #endif /* _cgmanager_h_ */
diff --git a/src/systemd-shim.c b/src/systemd-shim.c
index f8f74c7..940a39b 100644
--- a/src/systemd-shim.c
+++ b/src/systemd-shim.c
@@ -223,6 +223,7 @@ main (void)
                   shim_name_lost,
                   NULL, NULL);
 
+  cgmanager_moveself();
   while (1)
     g_main_context_iteration (NULL, TRUE);
 }
-- 
1.9.1

