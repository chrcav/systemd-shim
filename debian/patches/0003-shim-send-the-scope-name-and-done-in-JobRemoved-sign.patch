From e113e6f558397a6a2495c87f5e1761b9b81162fc Mon Sep 17 00:00:00 2001
From: Serge Hallyn <serge.hallyn@ubuntu.com>
Date: Mon, 14 Jul 2014 19:31:02 -0400
Subject: [PATCH 3/3] shim: send the scope name and "done" in JobRemoved signal
 for Transient

Signed-off-by: Serge Hallyn <serge.hallyn@ubuntu.com>
---
 src/cgroup-unit.c  | 3 ++-
 src/systemd-shim.c | 2 +-
 2 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/src/cgroup-unit.c b/src/cgroup-unit.c
index d6f9739..6d134ac 100644
--- a/src/cgroup-unit.c
+++ b/src/cgroup-unit.c
@@ -157,7 +157,8 @@ cgroup_unit_stop (Unit *unit)
 static const gchar *
 cgroup_unit_get_state (Unit *unit)
 {
-  return "static";
+  CGroupUnit *gc = (CGroupUnit *)unit;
+  return gc->name;
 }
 
 Unit *
diff --git a/src/systemd-shim.c b/src/systemd-shim.c
index 940a39b..cc763c3 100644
--- a/src/systemd-shim.c
+++ b/src/systemd-shim.c
@@ -148,7 +148,7 @@ shim_method_call (GDBusConnection       *connection,
           g_dbus_method_invocation_return_value (invocation, g_variant_new ("(o)", "/"));
           g_dbus_connection_emit_signal (connection, sender, "/org/freedesktop/systemd1",
                                          "org.freedesktop.systemd1.Manager", "JobRemoved",
-                                         g_variant_new ("(uoss)", 0, "/", "", ""), NULL);
+                                         g_variant_new ("(uoss)", 0, "/", unit_get_state(unit), "done"), NULL);
           g_variant_unref (properties);
           g_object_unref (unit);
           goto success;
-- 
1.9.1

